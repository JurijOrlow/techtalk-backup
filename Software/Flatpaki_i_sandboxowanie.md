# Co to jest Flatpak i dlaczego sandboxowanie aplikacji powinno by przyszoci software'u komputerowego?
## CZYLI WASZ ULUBIONY LINUXOWY WIR ZNW PRZYCHODZI, 呕EBY WAS CZEGO NAUCZY I PRZY OKAZJI POMARUDZI 
No dobra, ale od pocztku zaczynajc. Zakadam z cakiem du偶 doz pewnoci, 偶e znaczna wikszo z was posiada na swoim komputerze lub laptopie Windowsa. Zgaduj, 偶e wikszo 10, niekt贸rzy mo偶e jeszcze 7, inni ju偶 11, ale to nie jest istotne. Rozchodzi si o co innego.

Pobierzcie z internetu dowolny program - dajmy na to Gimpa. Zainstalujcie go, u偶ywajcie przez chwil - otw贸rzcie jakie zdjcie, stw贸rzcie jaki projekt, zapiszcie go i wyjd藕cie. A teraz usucie Gimpa. Nic prostszego, wchodzimy w ustawienia, aplikacj, dodaj/usu programy, klikamy odinstaluj. Finito.

No nie do koca, bo cay ten proces ma kilka zasadniczych problem贸w, kt贸re postaram si wylistowa:

1. 呕eby zainstalowa Gimpa potrzebowalicie pliku instalacyjnego. Nic prostszego, wchodzicie na stron Gimpa i klikacie "Pobierz". Przegldarka zapisuje wam w folderze "Pobrane" pliczek .exe i ju偶 jestecie gotowi do instalacji. Dwuklik i uruchamia si instalator. Jednak co jeli strona Gimpa zostaa shakowana? Kto wstawi zainfekowany wirusem plik na stron? Zastan贸wcie si nad tym.

2. Podczas instalacji wybieramy miejsce instalacji. Albo i nie, bo obecnie sporo instalator贸w ukrywa to za "Funkcjami zaawansowanymi", nawet nie pokazujc u偶ytkownikowi lokalizacji. Wszystko fajnie, dop贸ki nie musisz znale藕 folderu z t aplikacj. Czy jest w Program Files? A mo偶e Program Files (x86)? A mo偶e po prostu tworzy osobny folder z nazw aplikacji na dysku C? A mo偶e jeszcze jako inaczej, tworzy folder z nazw firmy, a wewntrz dopiero folder z nazw aplikacji?

3. Podczas u偶ywania aplikacja zapisuje sobie na komputerze jakie dane. Gdzie one s? Co to za dane? Jakie pliki? Tu wracamy do problemu numer 1, aplikacja ma dostp do caego dysku i mo偶e bez problemu zapisa cokolwiek, gdziekolwiek (i nie, nie licz wyskakujcego okienka, pytajcego czy zezwoli aplikacji na dziaanie jako administrator, bo realistycznie 99% u偶ytkownik贸w po prostu kliknie TAK)

4. I ostatnie - usuwamy aplikacj. Czy usunlimy wszystko? A za choler, zostaj mieci w Dokumentach, w LocalLow, AppData, w rejestrze. Wydawa by si mogo niedu偶o, ale polecam eksperyment - uruchomi czyst wirtualk z Windowsem 10, zainstalowa z 10 aplikacji, od razu je odinstalowa i por贸wna sobie ile jest wolnego miejsca na dysku. W teorii powinno by tyle samo, co do bita. A w rzeczywistoci gdzie nam megabajty znikaj. Pomn贸偶cie to przez tysice aplikacji, kt贸re zainstalujecie i usuniecie przez lata u偶ytkowania komputera i ju偶 wiadomo czemu na Windowsie magicznie znika miejsce na dysku.

I jasne, wszystkie te problemy dla u偶ytkownika technicznego nie s w og贸le problemami, przecie偶 wiemy jak sobie z nimi radzi! Tylko 偶e ilu nas, technicznych jest? 5%? 10? Reszta to zwykli u偶ytkownicy, kt贸rzy nawet jak komputer im zwolni przez kopark krypto to stwierdz, 偶e po prostu ten typ tak ma.
## I TU CAY NA BIAO WCHODZI LINUX ZE SWOIM SANDBOXOWANIEM!
No dobra, ale najpierw trzeba wyjani czym jest sandboxowanie lub konteneryzacja aplikacji. Ci, kt贸rzy to wiedz i z tym pracuj - wybaczcie za koszmarne uproszczenia, mo偶ecie miao ten paragraf pomin. Nic nie stracicie, a tylko pominiecie sekcj, kt贸ra mo偶e was wkurzy 

Wic tak, o aplikacjach sandboxowanych lub konteneryzowanych mo偶na pomyle jak o pakowaniu zestaw贸w Lego do maych szczelnych, zamykanych na k贸deczk pudeeczek i dopiero do skrzyni, zamiast wrzucania wszystkich element贸w razem do jednej wielkiej skrzyni. Aplikacje, wszystkie ich zale偶noci, wszystkie pliki, konfiguracje i cae hokus pokus, o kt贸rych nawet si filologom nie nio zostaje zamknite w jednej lokalizacji, typowo w jednym folderze, z kt贸rego wydosta si mog tylko i wycznie je偶eli u偶ytkownik wyrazi wiadomie tak ch i wol.

W naszej analogii do Lego byoby to wyjmowanie ludzika z zestawu Gwiazdy mierci, 偶eby umieci go na wanie wybudowanym Sokole Millenium. I owszem, majc wszystko razem te偶 mo偶emy to zrobi, ba mniej jest z tym zachodu, po prostu grzebiemy i znajdujemy. Ale co, je偶eli mamy te偶 zestawy z szarymi, ale nieco ciemniejszymi elementami? Albo figurk Hana Solo w innym outficie, kt贸ry nie pasuje do tego zestawu Sokoa Millenium i niechccy u偶yjemy tych element贸w, bo wszystkie s razem? Nasi znajomi nas wymiej, pokazujc 偶e Sok贸 nie by tutaj ciemniejszy, a kiesze Hana bya w innym miejscu!

A tak na powa偶nie, sandboxowanie ma dwa g贸wne cele - organizacj i bezpieczestwo. Po pierwsze wszystkie pliki s zamknite w jednym folderze, je偶eli chcesz usun aplikacj po prostu usuwasz ten folder i nie zostaje po niej 偶aden lad. Tak, jakby nigdy jej tam nie byo. Po drugie, nawet je偶eli aplikacja jakim cudem zawieraaby wirusa, ten nie wydostanie si poza folder z t aplikacj, chyba 偶e wiadomie mu na to pozwolisz.

Co ciekawe, to nie jest nowa technologia. Wszystkie aplikacje na Androida 10+ i iOS 12 lub 13+ s sandboxowane (dlatego np. musimy wyra偶a zgod na dostp do plik贸w czy kamery), a tak偶e aplikacje z Apple Store na MacOS s sandboxowane (nie, te z .dmg to ju偶 zupenie inna kategoria i mo偶e kiedy to opisz). W zasadzie jedynym systemem, kt贸ry si broni przed t technologi jest Windows.
## WIEMY CO TO SANDBOXOWANIE. TO TERAZ CO TO TEN WSPOMNIANY FLATPAK?
C贸偶, jest to jeden z dw贸ch g贸wnych standard贸w sandboxowania dla Linuxa (a tak偶e dla ChromeOS, dziki temu 偶e ten u偶ywa jdra Linuxa), dla MacOS wsparcia na razie nie ma, chocia偶 co tam zaczyna si o tym przebkiwa. Flatpak jest rozwijany przez Fedora Project we wsp贸pracy z firm Red Hat. Drugim standardem jest Snap, rozwijany przez Canonical (tw贸rc贸w Ubuntu) i u偶ywany tylko na Ubuntu. Nim nie bdziemy si tu zajmowa.

W ogromnym skr贸cie - developer (ale nie tylko, zwyky miertenik tak偶e) mo偶e doda skrypt instalacji swojej aplikacji do Flathub, czyli wielkiego repozytorium aplikacji Flatpakowych. Wpis zawiera dane skd pobra kod 藕r贸dowy, co jest potrzebne do kompilacji i instalacji, jak wyglda struktura i wymagane do dziaania dostpy. Nastpnie zgasza prob o dodanie, administratorzy Flathub przegldaj skrypt, upewniaj si 偶e nie ma tam 偶adnego zoliwego oprogramowania, 偶e jest on kompatybilny z Flatpak Guidelines, nie narusza praw patentowych itd. Aplikacja jest dodawana do Flathuba, a stamtd prosta droga do instalacji.

Na komputerze u偶ytkownika za instalacja czegokolwiek w formie Flatpaka jest tak prosta, jak instalacja czegokolwiek na iOS/Android. Wchodzisz w menad偶era oprogramowania twojej dystrybucji (czyli taki "Sklep z aplikacjami"), wyszukujesz aplikacj, klikasz "Zainstaluj". I tyle. Flatpak automatycznie pobiera i zapisuje w jednej lokalizacji niezbdne zale偶noci, tworzy "pudeeczko" dla aplikacji, ogranicza jej uprawnienia, dodaje skr贸t na pulpicie i wszystko gotowe. 呕adnego dziaania jako administrator, 偶adnego wybierania miejsca. Wszystko jest w jednym, znanym miejscu i dziaa tylko tak, jak mu na to pozwolimy. Usuwanie te偶 jest banalnie proste, menad偶er oprogramowania po prostu usuwa folder z aplikacj i kropka. Tylko tyle i a偶 tyle. Wywala to konieczno nurkowania w sie i szukania jaki exec贸w, liczc na to, 偶e nie bd zainfekowane.
## TO SKORO TAK, TO CZEMU KA呕DY TEGO NIE U呕YWA? CZY NIE JEST TO IDEALNE ROZWIZANIE?
No niby tak. Ale ma swoje problemy. Przede wszystkim - paczki flatpakowe czasami s du偶e. Przykadem jest KCalc, zwyky kalkulator. Standardowo do pobrania jest 130 MB. Na nowej instalacji Fedory, Flatpak pobiera 900 MB by zainstalowa KCalc. Ale ju偶 na mojej obecnej instalacji Fedory tylko 110 MB. O co chodzi?

C贸偶, jak wspomniaem wy偶ej - Flatpak automatycznie pobiera i zapisuje zale偶noci. S to rzeczy takie jak biblioteki C, wersje Java, czcionki, rzeczy kt贸rych aplikacja potrzebuje, ale nie s w niej zawarte. Je偶eli tych zale偶noci nie ma na komputerze, Flatpak musi je pobra i zapisa. Z drugiej jednak strony, pobiera je raz. To znaczy, 偶e je偶eli pobieramy KCalc, kt贸ry u偶ywa danej czcionki, a nastpnie pobierzemy aplikacj, kt贸ra tak偶e u偶ywa tej czcionki, Flatpak pominie t zale偶no, poniewa偶 ju偶 masz j na komputerze. Wic im mniej mamy aplikacji z Flatpaka, tym wiksze s rozmiary do pobrania. To akurat jest problem wszystkich aplikacji sandboxowanych.

Kolejn rzecz s problemy wynikajce z ograniczania dostpu do plik贸w, kt贸re czasem mog zdenerwowa. Przykad, dugo nie mogem wyczai, czemu QNapi, program do pobierania napis贸w, pokazywa 偶e napisy pobrano, ale nie mogem ich znale藕. Okazao si, 偶e program nie mia dostpu do katalogu, w kt贸rym mia te napisy zapisa. Z jednej strony to dobrze, dowodzi 偶e sandboxy s bezpieczne. Z drugiej uwiadomienie sobie, 偶e to by problem zajo mi upokarzajco du偶o czasu.
Ostatnie - wydajno. Aplikacje sandboxowane maj typowo nieco wiksze zu偶ycie RAMu ni偶 aplikacje zwyke. Wi偶e si to z faktem, 偶e pomidzy pamici a aplikacj jest jeszcze caa "zapora" Flatpaka. Nie s to du偶e r贸偶nice, rzdu megabajt贸w, ale jednak s. Przez to nie wszystkie aplikacje da si zsandboxowa, jak chocia偶by gry wideo.
## TO POWINNIMY U呕YWA SANDBOXOWANIA, CZY NIE?!
Ale偶 oczywicie! Kurde, przecie偶 praktycznie ka偶dy telefon na wiecie ju偶 u偶ywa tej technologii. Linuxy te偶 praktycznie wszystkie, nawet MacOS poszed w stron sandboxowania. Lepsza organizacja plik贸w, wiksze bezpieczestwo. Problemy s, ale jestem pewien, 偶e da si je obej lub rozwiza. Sandboxowanie powinno by przyszoci dystrybucji aplikacji.

Ale nie bdzie. Dlaczego? Dlatego, 偶e najwikszy OS na wiecie, Windows, ma sandboxowanie w trbce. Schemat instalacji oprogramowania na Windowsie pozostaje ten sam jeszcze od czas贸w DOSa. Dosownie NIC si nie zmienio w tym aspekcie w Windowsie od prawie 30 lat i nie spodziewam si, by kiedykolwiek si zmienio. Dlaczego tak jest? C贸偶, mo偶na si tylko domyla. Je偶eli kto wie, lub ma pomys, to prosz o sugestie. Je偶eli nie, to myl, 偶e chyba czas zamyka ten temat.